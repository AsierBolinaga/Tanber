package abolinaga.tander;

import java.io.BufferedReader;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.net.HttpURLConnection;
import java.net.URL;
import java.util.List;

import android.annotation.SuppressLint;
import android.app.Activity;
import android.app.Dialog;
import android.app.ProgressDialog;
import android.os.AsyncTask;
import android.os.Bundle;
import android.view.View;
import android.view.View.OnClickListener;
import android.widget.Button;
import android.widget.EditText;
import android.widget.Toast;

public class RegisterLoginActivity extends ActionBarActivity 
{
	private EditText editTextUserName;    
	private EditText editTextPassword; 
	
	public static final String USER_NAME = "USERNAME";  
	
	String strUserName;    
	String strPassword;
	
	@Override
	protected void onCreate(Bundle savedInstanceState) 
	{
		super.onCreate(savedInstanceState);
		setContentView(R.layout.registerlogin);
		
		editTextUserName = (EditText) findViewById(R.id.editTextUserName);
		editTextPassword = (EditText) findViewById(R.id.editTextPassword);
	}

	public void invokeLogin(View view)
	{        
		strUserName = editTextUserName.getText().toString();       
		strPassword = editTextPassword.getText().toString();         
		login(strUserName, strPassword);     
	}

	private void login(final String username, String password) 
	{         
		class LoginAsync extends AsyncTask<String, Void, String>
		{             
			private Dialog loadingDialog;             
			
			@Override            
			protected void onPreExecute() 
			{                
				super.onPreExecute();                
				loadingDialog = ProgressDialog.show(RegisterLoginActivity.this, "Please wait", "Loading...");            
			}             
			
			@Override           
			protected String doInBackground(String... params) 
			{                
				String uname = params[0];                
				String pass = params[1];                 
				
				InputStream is = null;               
				List<NameValuePair> nameValuePairs = new ArrayList<NameValuePair>();                
				nameValuePairs.add(new BasicNameValuePair("username", uname));                
				nameValuePairs.add(new BasicNameValuePair("password", pass));                
				String result = null;                 
				
				try
				{                    
					HttpClient httpClient = new DefaultHttpClient();                    
					HttpPost httpPost = new HttpPost(                            
							"http://simplifiedcoding.16mb.com/login.php");                    
					httpPost.setEntity(new UrlEncodedFormEntity(nameValuePairs));                     
					HttpResponse response = httpClient.execute(httpPost);                    
					HttpEntity entity = response.getEntity();                     
					is = entity.getContent();                    
					BufferedReader reader = new BufferedReader(new InputStreamReader(is, "UTF-8"), 8);                    
					StringBuilder sb = new StringBuilder();                     
					String line = null;                   
					while ((line = reader.readLine()) != null)                    
					{                       
						sb.append(line + "\n");                  
						}                  
					result = sb.toString();               
					} 
				catch (ClientProtocolException e)
				{                    
					e.printStackTrace();               
				} 
				catch (UnsupportedEncodingException e) 
				{                    
					e.printStackTrace();                
				} 
				catch (IOException e)
				{                    
					e.printStackTrace();               
				}                
				return result;            
			}
		}
	}
}
